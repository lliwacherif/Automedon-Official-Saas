import{d as J,$ as K,a0 as O,a2 as W,r as y,V as X,Y as Z,U as N,a as b,e as i,o as d,g as t,D as F,G as tt,j as r,a1 as et,f as D,l as P,v as U,i as o,I as $,F as H,n as Y,h as st}from"./index-C1y38dmy.js";import{M as at}from"./useMaintenanceRecords-C_yXy1UQ.js";import{f as C}from"./date-BpD5EXL9.js";import{A as ot}from"./arrow-left-I4JqDLzj.js";const rt={key:0,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},nt={class:"mb-6 flex justify-between items-center"},lt={class:"flex items-center space-x-4 bg-white p-3 rounded-lg shadow-sm border border-gray-200"},it={class:"flex items-center space-x-2"},dt={class:"flex items-center space-x-2"},ct={class:"bg-white shadow overflow-hidden sm:rounded-lg mb-8"},ut={class:"px-4 py-5 sm:px-6 flex justify-between items-start"},mt={class:"text-2xl font-bold leading-6 text-gray-900 flex items-center gap-2"},xt={class:"mt-1 text-sm text-gray-500 flex items-center gap-2"},ft={class:"bg-gray-100 px-2 py-0.5 rounded text-gray-700 font-mono"},pt={key:0,class:"h-16 w-24 flex-shrink-0"},vt=["src"],_t={class:"border-t border-gray-200 px-4 py-5 sm:px-6"},yt={class:"flex items-center justify-end"},gt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ht={class:"bg-white shadow overflow-hidden sm:rounded-lg"},bt={class:"px-4 py-5 sm:px-6 border-b border-gray-200 flex justify-between items-center"},wt={class:"text-lg leading-6 font-medium text-gray-900"},Dt={class:"text-sm font-bold text-green-600"},Tt={class:"overflow-x-auto"},kt={class:"min-w-full divide-y divide-gray-300"},Et={class:"bg-gray-50"},Nt={scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"},Ct={scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900"},Rt={scope:"col",class:"px-3 py-3.5 text-right text-sm font-semibold text-gray-900"},St={class:"divide-y divide-gray-200 bg-white"},Mt={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"},jt={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},At={class:"whitespace-nowrap px-3 py-4 text-right text-sm text-gray-900 font-medium"},Vt={key:0},Lt={colspan:"3",class:"px-3 py-8 text-center text-sm text-gray-500"},qt={class:"bg-white shadow overflow-hidden sm:rounded-lg"},It={class:"px-4 py-5 sm:px-6 border-b border-gray-200 flex justify-between items-center"},Bt={class:"text-sm font-bold text-red-600"},Ft={class:"overflow-x-auto"},Pt={class:"min-w-full divide-y divide-gray-300"},Ut={class:"divide-y divide-gray-200 bg-white"},$t={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"},Ht={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},Yt={class:"whitespace-nowrap px-3 py-4 text-right text-sm text-gray-900 font-medium"},zt={key:0},Gt={key:1,class:"flex justify-center items-center h-64"},Zt=J({__name:"Show",setup(Qt){const{t:f}=K(),{tenantPath:z}=O(),T=W().params.id,n=y(null),R=y([]),S=y([]),k=y(!0),c=y(""),u=y("");X(async()=>{await G()});async function G(){k.value=!0;try{const s=Z();let e=N.from("cars").select("*").eq("id",T);s.currentTenant?.id&&(e=e.eq("tenant_id",s.currentTenant.id));const{data:a,error:m}=await e.single();if(m)throw m;n.value=a;const{data:p,error:x}=await N.from("reservations").select("*").eq("car_id",T).order("start_date",{ascending:!1});if(x)throw x;R.value=p||[];const{data:_,error:v}=await N.from("maintenance_records").select("*").eq("car_id",T).order("maintenance_date",{ascending:!1});if(v)throw v;S.value=_||[]}catch(s){console.error("Error fetching car history:",s)}finally{k.value=!1}}const g=s=>new Intl.NumberFormat("fr-TN",{style:"currency",currency:"TND"}).format(s),l=s=>{if(!s)return null;const e=new Date(s);return e.setHours(0,0,0,0),e},M=(s,e)=>{if(!c.value&&!u.value)return!0;if(!e){const _=l(s),v=l(c.value),h=l(u.value);return!(v&&_<v||h&&_>h)}const a=l(s),m=l(e),p=l(c.value),x=l(u.value);return!(x&&a>x||p&&m<p)},w=b(()=>R.value.filter(s=>M(s.start_date,s.end_date))),E=b(()=>S.value.filter(s=>M(s.maintenance_date))),j=b(()=>!c.value&&!u.value?w.value.reduce((s,e)=>s+(e.total_price||0),0):w.value.reduce((s,e)=>{const a=l(e.start_date),m=l(e.end_date),p=1e3*60*60*24,x=Math.round((m.getTime()-a.getTime())/p),_=x>0?x:1,v=(e.total_price||0)/_,h=l(c.value)||new Date(-864e13),L=l(u.value)||new Date(864e13),q=a<h?h:a,I=m>L?L:m;if(q>I)return s;const B=Math.round((I.getTime()-q.getTime())/p)+1;if(B<=0)return s;const Q=v*B;return s+Q},0)),A=b(()=>E.value.reduce((s,e)=>s+(e.cost||0),0)),V=b(()=>j.value-A.value);return(s,e)=>!k.value&&n.value?(d(),i("div",rt,[t("div",nt,[F(r(et),{to:r(z)("/admin/history"),class:"flex items-center text-sm text-gray-500 hover:text-gray-700"},{default:tt(()=>[F(r(ot),{class:"w-4 h-4 mr-1"}),st(" "+o(r(f)("admin.history.back_to_list")),1)]),_:1},8,["to"]),t("div",lt,[t("div",it,[e[3]||(e[3]=t("label",{class:"text-sm font-medium text-gray-700"},"Du:",-1)),P(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[U,c.value]])]),t("div",dt,[e[4]||(e[4]=t("label",{class:"text-sm font-medium text-gray-700"},"Au:",-1)),P(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>u.value=a),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[U,u.value]])]),c.value||u.value?(d(),i("button",{key:0,onClick:e[2]||(e[2]=a=>{c.value="",u.value=""}),class:"text-xs text-indigo-600 hover:text-indigo-800 font-medium"}," Réinitialiser ")):D("",!0)])]),t("div",ct,[t("div",ut,[t("div",null,[t("h3",mt,o(n.value.brand)+" "+o(n.value.model),1),t("p",xt,[t("span",ft,o(n.value.license_plate),1),t("span",{class:$({"text-green-600":n.value.status==="disponible","text-blue-600":n.value.status==="loue","text-red-600":n.value.status==="maintenance"})}," ● "+o(n.value.status?r(f)(`admin.fleet.${n.value.status}`):n.value.status),3)])]),n.value.image_url?(d(),i("div",pt,[t("img",{src:n.value.image_url,alt:"",class:"h-full w-full object-cover rounded-md"},null,8,vt)])):D("",!0)]),t("div",_t,[t("div",yt,[t("div",{class:$(["text-xl font-bold",V.value>=0?"text-green-600":"text-red-600"])}," Revenu Net: "+o(g(V.value)),3)])])]),t("div",gt,[t("div",ht,[t("div",bt,[t("h3",wt,o(r(f)("admin.history.reservations_history")),1),t("div",Dt," Total: "+o(g(j.value)),1)]),t("div",Tt,[t("table",kt,[t("thead",Et,[t("tr",null,[t("th",Nt,o(r(f)("admin.reservations.client")),1),t("th",Ct,o(r(f)("admin.reservations.dates")),1),t("th",Rt,o(r(f)("admin.reservations.total_price")),1)])]),t("tbody",St,[(d(!0),i(H,null,Y(w.value,a=>(d(),i("tr",{key:a.id},[t("td",Mt,o(a.client_name),1),t("td",jt,o(r(C)(a.start_date))+" - "+o(r(C)(a.end_date)),1),t("td",At,o(g(a.total_price)),1)]))),128)),w.value.length===0?(d(),i("tr",Vt,[t("td",Lt,o(r(f)("admin.history.no_reservations")),1)])):D("",!0)])])])]),t("div",qt,[t("div",It,[e[5]||(e[5]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900"}," Historique des Coûts ",-1)),t("div",Bt," Total: "+o(g(A.value)),1)]),t("div",Ft,[t("table",Pt,[e[7]||(e[7]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"}," Type "),t("th",{scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900"}," Date "),t("th",{scope:"col",class:"px-3 py-3.5 text-right text-sm font-semibold text-gray-900"}," Coût ")])],-1)),t("tbody",Ut,[(d(!0),i(H,null,Y(E.value,a=>(d(),i("tr",{key:a.id},[t("td",$t,o(r(at)[a.maintenance_type]||a.maintenance_type),1),t("td",Ht,o(r(C)(a.maintenance_date)),1),t("td",Yt,o(g(a.cost)),1)]))),128)),E.value.length===0?(d(),i("tr",zt,[...e[6]||(e[6]=[t("td",{colspan:"3",class:"px-3 py-8 text-center text-sm text-gray-500"}," Aucun entretien enregistré. ",-1)])])):D("",!0)])])])])])])):(d(),i("div",Gt,[...e[8]||(e[8]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"},null,-1)])]))}});export{Zt as default};
