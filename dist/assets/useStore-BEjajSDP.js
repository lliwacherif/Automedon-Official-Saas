import{r as n,U as l}from"./index-BlVnYu75.js";function w(){const s=n([]),t=n(!1),o=n(null);async function c(){t.value=!0,o.value=null;try{const{data:e,error:r}=await l.from("store_apps").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(r)throw r;s.value=e||[]}catch(e){o.value=e.message,console.error("Error fetching apps:",e)}finally{t.value=!1}}async function p(e,r){t.value=!0,o.value=null;try{let a=e.icon_url||null;if(r){const m=r.name.split(".").pop(),u=`global/${Math.random()}.${m}`,{error:f}=await l.storage.from("store-icons").upload(u,r);if(f)throw f;const{data:g}=l.storage.from("store-icons").getPublicUrl(u);a=g.publicUrl}const{data:v,error:i}=await l.from("store_apps").insert([{name:e.name,description:e.description,price:e.price,icon_url:a,is_active:!0}]).select().single();if(i)throw i;return await c(),v}catch(a){throw o.value=a.message,console.error("Error adding app:",a),a}finally{t.value=!1}}async function d(e){t.value=!0,o.value=null;try{const{error:r}=await l.from("store_apps").delete().eq("id",e);if(r)throw r;s.value=s.value.filter(a=>a.id!==e)}catch(r){o.value=r.message,console.error("Error deleting app:",r)}finally{t.value=!1}}return{apps:s,loading:t,error:o,fetchApps:c,addApp:p,deleteApp:d}}export{w as u};
