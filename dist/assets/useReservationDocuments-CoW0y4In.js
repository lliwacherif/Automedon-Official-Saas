import{r as u,U as i}from"./index-BgCL6C0w.js";import{u as p}from"./useFileUpload-DHz28v0K.js";function h(){const n=u([]),o=u(!1),t=u(null),{uploadFile:d,deleteFile:c}=p();async function f(a){o.value=!0,t.value=null;try{const{data:r,error:e}=await i.from("reservation_documents").select("*").eq("reservation_id",a).order("uploaded_at",{ascending:!1});if(e)throw e;n.value=r}catch(r){t.value=r.message,console.error("Error fetching documents:",r)}finally{o.value=!1}}async function m(a,r){o.value=!0,t.value=null;try{const e=await d(r,"contracts",`reservation-${a}`);if(!e)throw new Error("Failed to upload file to storage");const{data:l,error:s}=await i.from("reservation_documents").insert({reservation_id:a,file_url:e,file_name:r.name}).select().single();if(s)throw await c(e,"contracts"),s;return l&&n.value.unshift(l),l}catch(e){throw t.value=e.message,console.error("Error uploading document:",e),e}finally{o.value=!1}}async function v(a,r){if(confirm("Êtes-vous sûr de vouloir supprimer ce document ?")){o.value=!0,t.value=null;try{if(!await c(r,"contracts"))throw new Error("Failed to delete file from storage");const{error:l}=await i.from("reservation_documents").delete().eq("id",a);if(l)throw l;n.value=n.value.filter(s=>s.id!==a)}catch(e){t.value=e.message,console.error("Error deleting document:",e),alert("Erreur lors de la suppression du document")}finally{o.value=!1}}}return{documents:n,loading:o,error:t,fetchDocuments:f,uploadDocument:m,deleteDocument:v}}export{h as u};
