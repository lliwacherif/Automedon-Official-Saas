import{r as l,U as o}from"./index-6E32DxFF.js";function E(){const s=l([]),t=l(!1),n=l(null);async function i(){t.value=!0,n.value=null;try{const{data:a,error:r}=await o.from("store_apps").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(r)throw r;s.value=a||[]}catch(a){n.value=a.message,console.error("Error fetching apps:",a)}finally{t.value=!1}}async function f(a,r){t.value=!0,n.value=null;try{let e=a.icon_url||null;if(r){const w=r.name.split(".").pop(),u=`global/${Math.random()}.${w}`,{error:p}=await o.storage.from("store-icons").upload(u,r);if(p)throw p;const{data:y}=o.storage.from("store-icons").getPublicUrl(u);e=y.publicUrl}const{data:h,error:c}=await o.from("store_apps").insert([{name:a.name,description:a.description,price:a.price,icon_url:e,is_active:!0}]).select().single();if(c)throw c;return await i(),h}catch(e){throw n.value=e.message,console.error("Error adding app:",e),e}finally{t.value=!1}}async function d(a){t.value=!0,n.value=null;try{const{error:r}=await o.from("store_apps").delete().eq("id",a);if(r)throw r;s.value=s.value.filter(e=>e.id!==a)}catch(r){n.value=r.message,console.error("Error deleting app:",r)}finally{t.value=!1}}async function g(a,r){t.value=!0,n.value=null;try{const{error:e}=await o.from("app_assignments").insert([{app_id:a,tenant_id:r,status:"active"}]);if(e)throw e}catch(e){throw n.value=e.message,console.error("Error assigning app:",e),e}finally{t.value=!1}}async function m(a,r){t.value=!0,n.value=null;try{const{error:e}=await o.from("app_assignments").delete().eq("app_id",a).eq("tenant_id",r);if(e)throw e}catch(e){throw n.value=e.message,console.error("Error unassigning app:",e),e}finally{t.value=!1}}async function v(a){try{const{data:r,error:e}=await o.from("app_assignments").select("*").eq("app_id",a);if(e)throw e;return r}catch(r){return console.error("Error fetching assignments:",r),[]}}return{apps:s,loading:t,error:n,fetchApps:i,addApp:f,deleteApp:d,assignAppToTenant:g,unassignAppFromTenant:m,fetchAppAssignments:v}}export{E as u};
