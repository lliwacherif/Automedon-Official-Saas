import{r as u,a as h,U as s,Y as d}from"./index-BUxJS3To.js";const w={OIL_CHANGE:"Vidange",BRAKE_SERVICE:"Freins",REPAIR:"RÃ©paration",ROUTINE_CHECK:"Visite Technique",LAVAGE:"Lavage",ASSURANCE:"Assurance",VIGNETTE:"Vignette",LEASING:"Leasing (Cambiale)"};function p(){const l=u([]),n=u(!1),t=u(null),f=h(()=>l.value.reduce((r,a)=>r+Number(a.cost),0));async function i(r){n.value=!0,t.value=null;const a=d();try{let e=s.from("maintenance_records").select("*").eq("car_id",r);a.currentTenant?.id&&(e=e.eq("tenant_id",a.currentTenant.id));const{data:c,error:o}=await e.order("maintenance_date",{ascending:!1});if(o)throw o;l.value=c||[]}catch(e){t.value=e.message,console.error("Error fetching maintenance records:",e)}finally{n.value=!1}}async function m(r){n.value=!0,t.value=null;try{const{data:a,error:e}=await s.from("maintenance_records").select("*").eq("id",r).single();if(e)throw e;return a}catch(a){return t.value=a.message,console.error("Error fetching maintenance record:",a),null}finally{n.value=!1}}async function E(r){n.value=!0,t.value=null;const a=d();if(!a.currentTenant){t.value="Tenant not selected",n.value=!1;return}try{const e={...r,tenant_id:a.currentTenant.id},{data:c,error:o}=await s.from("maintenance_records").insert([e]).select().single();if(o)throw o;return r.car_id&&await i(r.car_id),c}catch(e){throw t.value=e.message,console.error("Error creating maintenance record:",e),e}finally{n.value=!1}}async function v(r,a){n.value=!0,t.value=null;try{const{data:e,error:c}=await s.from("maintenance_records").update(a).eq("id",r).select().single();if(c)throw c;return e&&e.car_id&&await i(e.car_id),e}catch(e){throw t.value=e.message,console.error("Error updating maintenance record:",e),e}finally{n.value=!1}}async function g(r,a){n.value=!0,t.value=null;try{const{error:e}=await s.from("maintenance_records").delete().eq("id",r);if(e)throw e;await i(a)}catch(e){throw t.value=e.message,console.error("Error deleting maintenance record:",e),e}finally{n.value=!1}}async function _(r){try{const{data:a,error:e}=await s.from("maintenance_records").select("cost").eq("car_id",r);if(e)throw e;return(a||[]).reduce((c,o)=>c+Number(o.cost),0)}catch(a){return console.error("Error calculating total maintenance cost:",a),0}}return{maintenanceRecords:l,loading:n,error:t,totalMaintenanceCost:f,fetchMaintenanceRecords:i,getMaintenanceRecord:m,createMaintenanceRecord:E,updateMaintenanceRecord:v,deleteMaintenanceRecord:g,calculateTotalMaintenanceCost:_}}export{w as M,p as u};
