import{u as E}from"./useReservations-D-TYcptp.js";import{c as N,Y as F,r as _,U as R,d as D,u as V,e as x,f as j,o as p,g as t,C as f,j as o,a4 as B,h as C,i as u,X as q,W as A,$ as I,a0 as U,V as M,F as O,n as z,b as T,E as G,a1 as W}from"./index-6E32DxFF.js";import{a as v}from"./date-BpD5EXL9.js";import{F as X}from"./file-down-rO7zOG3M.js";import{L as Y}from"./loader-circle-ivbMhOq-.js";import{F as H}from"./file-text-D6FavWBd.js";import{S as J}from"./square-pen-Dz5WJ_Ku.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=N("LockIcon",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);function Q(){function g(h,a){if(!a||!a.length)return;const n=";",d=Object.keys(a[0]),m=[d.join(n),...a.map(l=>d.map(y=>{let c=l[y]===null||l[y]===void 0?"":l[y];return c=c instanceof Date?c.toLocaleString():c.toString().replace(/"/g,'""'),c.search(/("|,|\n)/g)>=0&&(c=`"${c}"`),c}).join(n))].join(`
`),r=new Blob(["\uFEFF"+m],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a");if(e.download!==void 0){const l=URL.createObjectURL(r);e.setAttribute("href",l),e.setAttribute("download",h),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}return{exportToCsv:g}}const w=_(new Set),$=_(!1),S=_(!1);function Z(){const g=F();async function h(){if(g.currentTenant?.id){$.value=!0;try{const{data:n,error:d}=await R.from("app_assignments").select(`
                    app_id,
                    store_apps (
                        name
                    )
                `).eq("tenant_id",g.currentTenant.id);if(d)throw d;w.value.clear(),n?.forEach(m=>{m.store_apps?.name&&w.value.add(m.store_apps.name)}),S.value=!0}catch(n){console.error("Error fetching assigned apps:",n)}finally{$.value=!1}}}function a(n){return w.value.has(n)}return{assignedApps:w,loading:$,loaded:S,fetchAssignedApps:h,hasAccess:a}}const tt={key:0,class:"fixed inset-0 z-[100] overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},et={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},st={class:"relative inline-block align-middle bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:max-w-md w-full border-2 border-indigo-100"},ot={class:"bg-white px-6 py-6 pb-4"},at={class:"sm:flex sm:items-start"},nt={class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},it={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},rt={class:"mt-2"},lt={class:"text-sm text-gray-500"},ct={class:"font-bold text-gray-800"},dt={class:"bg-gray-50 px-6 py-4 sm:flex sm:flex-row-reverse"},pt=D({__name:"UpsellModal",props:{show:{type:Boolean},appName:{}},emits:["close"],setup(g,{emit:h}){const a=h;F();const n=V(),d=A();function m(){a("close"),n.isRoot?d.push({name:"root.store"}):alert("Please contact the platform administrator to purchase this app.")}return(r,e)=>r.show?(p(),x("div",tt,[t("div",et,[t("div",{class:"fixed inset-0 bg-black/60 transition-opacity backdrop-blur-sm","aria-hidden":"true",onClick:e[0]||(e[0]=l=>r.$emit("close"))}),e[7]||(e[7]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),t("div",st,[t("div",ot,[t("div",at,[t("div",nt,[f(o(B),{class:"h-6 w-6 text-indigo-600","aria-hidden":"true"})]),t("div",it,[e[6]||(e[6]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Feature Locked ",-1)),t("div",rt,[t("p",lt,[e[3]||(e[3]=C(" The ",-1)),t("span",ct,u(r.appName),1),e[4]||(e[4]=C(" app is required to access this feature. ",-1))]),e[5]||(e[5]=t("p",{class:"text-sm text-gray-500 mt-2"}," Unlock advanced invoicing, PDF generation, and more by adding this app to your workspace. ",-1))])])])]),t("div",dt,[t("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:m}," Get "+u(r.appName),1),t("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:e[1]||(e[1]=l=>r.$emit("close"))}," Cancel ")]),t("button",{onClick:e[2]||(e[2]=l=>r.$emit("close")),class:"absolute top-3 right-3 text-gray-400 hover:text-gray-500"},[f(o(q),{class:"h-5 w-5"})])])])])):j("",!0)}}),ut={class:"p-6"},mt={class:"flex justify-between items-center mb-6"},xt=["disabled"],ft={key:0,class:"flex justify-center py-12"},gt={key:1,class:"bg-white shadow-md rounded-lg overflow-hidden"},ht={class:"overflow-x-auto"},yt={class:"min-w-full divide-y divide-gray-200"},bt={class:"bg-white divide-y divide-gray-200"},vt={key:0},wt={class:"px-6 py-4 whitespace-nowrap"},_t={class:"text-sm font-medium text-gray-900"},kt={class:"text-xs text-gray-500"},$t={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ft={class:"px-6 py-4 whitespace-nowrap"},Tt={class:"text-sm font-medium text-gray-900"},St={class:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900"},Dt={class:"px-6 py-4 whitespace-nowrap text-center"},jt=["onClick","title"],At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},It=D({__name:"ReservationsTable",setup(g){const{t:h}=I(),{reservations:a,loading:n,fetchReservations:d}=E(),{tenantPath:m}=U(),{exportToCsv:r}=Q(),{hasAccess:e,fetchAssignedApps:l}=Z(),y=F(),c=A(),k=_(!1);function L(){const b=a.value.map(s=>({"Voiture & Plaque":`${s.car?.brand} ${s.car?.model}
${s.car?.plate_number}`,"Date Début":v(s.start_date),"Date Fin":v(s.end_date),Client:s.client_name,"Coût Total":`${s.total_price.toFixed(2)} TND`,"Contract ID":s.contract_number||""}));r(`reservations_${new Date().toISOString().split("T")[0]}.csv`,b)}function P(b){e("Facture Pro")?y.currentTenant?.slug&&c.push({name:"admin.invoices.build",params:{tenantSlug:y.currentTenant.slug,id:b.id}}):k.value=!0}return M(async()=>{d(),await l()}),(b,s)=>(p(),x("div",ut,[t("div",mt,[s[2]||(s[2]=t("h1",{class:"text-2xl font-bold text-gray-800"},"Tableau des Réservations",-1)),t("button",{onClick:L,disabled:o(n)||o(a).length===0,class:"flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[f(o(X),{class:"w-4 h-4 mr-2"}),s[1]||(s[1]=C(" Télécharger Excel ",-1))],8,xt)]),o(n)?(p(),x("div",ft,[f(o(Y),{class:"animate-spin h-8 w-8 text-indigo-600"})])):(p(),x("div",gt,[t("div",ht,[t("table",yt,[s[4]||(s[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Voiture & Plaque "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date Début "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date Fin "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Client "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Coût Total "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Facture "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Modifier ")])],-1)),t("tbody",bt,[o(a).length===0?(p(),x("tr",vt,[...s[3]||(s[3]=[t("td",{colspan:"7",class:"px-6 py-4 text-center text-gray-500"}," Aucune réservation trouvée. ",-1)])])):j("",!0),(p(!0),x(O,null,z(o(a),i=>(p(),x("tr",{key:i.id,class:"hover:bg-gray-50"},[t("td",wt,[t("div",_t,u(i.car?.brand)+" "+u(i.car?.model),1),t("div",kt,u(i.car?.plate_number),1)]),t("td",$t,u(o(v)(i.start_date)),1),t("td",Ct,u(o(v)(i.end_date)),1),t("td",Ft,[t("div",Tt,u(i.client_name),1)]),t("td",St,u(i.total_price.toFixed(2))+" TND ",1),t("td",Dt,[t("button",{onClick:Lt=>P(i),class:"text-gray-500 hover:text-indigo-600 focus:outline-none transition-colors",title:o(e)("Facture Pro")?"Générer Facture":"Facture Pro requis"},[o(e)("Facture Pro")?(p(),T(o(H),{key:0,class:"h-5 w-5"})):(p(),T(o(K),{key:1,class:"h-4 w-4 text-gray-400"}))],8,jt)]),t("td",At,[f(o(W),{to:o(m)(`/admin/reservations/${i.id}`),class:"text-indigo-600 hover:text-indigo-900 flex items-center justify-center p-2 rounded-full hover:bg-indigo-50",title:"Modifier"},{default:G(()=>[f(o(J),{class:"h-4 w-4"})]),_:1},8,["to"])])]))),128))])])])])),f(pt,{show:k.value,"app-name":"Facture Pro",onClose:s[0]||(s[0]=i=>k.value=!1)},null,8,["show"])]))}});export{It as default};
