import{d as P,a0 as R,r as d,a as j,V as T,a2 as G,e as r,o as u,g as e,i as o,f as p,l as m,m as $,F as D,n as I,v as _,h as y,a3 as z,C as A,E as H,j as h,Z as J,k as W,W as K}from"./index-BUxJS3To.js";import{u as Z}from"./useCars-CcI3-SoQ.js";import{u as O}from"./useFileUpload-CqFsIgHj.js";const Q={class:"p-6"},X={class:"text-2xl font-semibold text-gray-900 mb-6"},Y={key:0,class:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded"},ee={class:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2"},te={class:"block text-sm font-medium text-gray-700"},ae={value:"",disabled:""},se=["value"],le={class:"block text-sm font-medium text-gray-700"},oe={class:"sm:col-span-2"},ne={class:"block text-sm font-medium text-gray-700 mb-2"},ie={class:"flex items-center gap-2"},re={key:0,class:"ml-4 text-sm text-gray-500"},ue={class:"font-mono font-bold"},de={class:"mt-1 text-sm text-gray-500"},me={class:"sm:col-span-2"},ce={class:"block text-sm font-medium text-gray-700 mb-2"},fe={class:"mb-3 flex items-center"},ge=["disabled"],pe={value:"disponible"},ve={value:"loue"},be={value:"maintenance"},xe={key:0,class:"mt-1 text-xs text-indigo-600"},_e={key:1,class:"mt-1 space-y-1"},ye={key:0,class:"text-xs text-gray-500"},he={class:"sm:col-span-2"},ke={key:0,class:"mb-4 relative inline-block"},we=["src"],$e={class:"flex justify-end space-x-3"},Ce=["disabled"],Le=P({__name:"Edit",setup(Ue){const{fetchCarById:C,createCar:U,updateCar:N}=Z(),{uploadFile:V,uploading:k}=O(),{tenantPath:w}=R(),v=G(),q=K(),b=d(!1),c=d(!1),i=d(""),g=d(null),f=d(""),L=["Renault","Dacia","Skoda","Hyundai","Seat","MG","Mahindra","Kia","Honda","Peugeot","Cherry","Geely","Volkswagen","Suzuki"],a=d({brand:"",model:"",plate_prefix:"",plate_suffix:"",status:"disponible",image_url:"",auto_manage_status:!0}),x=j(()=>a.value.plate_prefix&&a.value.plate_suffix?`${a.value.plate_prefix}TN${a.value.plate_suffix}`:"");T(async()=>{if(v.params.id){b.value=!0;const s=await C(Number(v.params.id));if(s){const t=s.plate_number.match(/^(\d+)TN(\d+)$/),n=t?t[1]:"",l=t?t[2]:"";a.value.brand=s.brand,a.value.model=s.model,a.value.plate_prefix=n,a.value.plate_suffix=l,a.value.status=s.status,a.value.image_url=s.image_url||"",a.value.auto_manage_status=s.auto_manage_status!==!1,f.value=s.image_url||""}}});function M(s){const n=s.target.files?.[0];if(n){if(!n.type.startsWith("image/")){i.value="Veuillez sÃ©lectionner une image valide";return}if(n.size>5*1024*1024){i.value="L'image ne doit pas dÃ©passer 5 MB";return}g.value=n;const l=new FileReader;l.onload=E=>{f.value=E.target?.result},l.readAsDataURL(n),i.value=""}}function F(){g.value=null,f.value="",a.value.image_url="";const s=document.getElementById("car-image");s&&(s.value="")}function S(s,t){return/^\d{1,3}$/.test(s)&&/^\d{1,4}$/.test(t)}async function B(){if(c.value=!0,i.value="",!S(a.value.plate_prefix,a.value.plate_suffix)){i.value="Format de plaque invalide. Utilisez uniquement des chiffres (ex: 245 TN 4521)",c.value=!1;return}try{let s=a.value.image_url;if(g.value){const n=await V(g.value,"car-images","cars");if(n)s=n;else throw console.error("Upload returned null"),new Error("Ã‰chec du tÃ©lÃ©chargement de l'image (URL manquante)")}const t={brand:a.value.brand,model:a.value.model,plate_number:x.value,status:a.value.status,image_url:s||void 0,auto_manage_status:a.value.auto_manage_status};b.value?await N(Number(v.params.id),t):await U(t),q.push(w("/admin/cars"))}catch(s){console.error("Error saving car:",s),i.value=s.message||"Une erreur est survenue lors de l'enregistrement"}finally{c.value=!1}}return(s,t)=>{const n=J("RouterLink");return u(),r("div",Q,[e("h1",X,o(b.value?s.$t("admin.fleet.edit_car"):s.$t("admin.fleet.create_car")),1),e("form",{onSubmit:W(B,["prevent"]),class:"bg-white shadow sm:rounded-lg p-6 space-y-6"},[i.value?(u(),r("div",Y,o(i.value),1)):p("",!0),e("div",ee,[e("div",null,[e("label",te,o(s.$t("admin.fleet.brand")),1),m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.brand=l),required:"",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},[e("option",ae,o(s.$t("admin.fleet.select_brand")),1),(u(),r(D,null,I(L,l=>e("option",{key:l,value:l},o(l),9,se)),64))],512),[[$,a.value.brand]])]),e("div",null,[e("label",le,o(s.$t("admin.fleet.model")),1),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.model=l),type:"text",required:"",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[_,a.value.model]])]),e("div",oe,[e("label",ne,o(s.$t("admin.fleet.plate_number")),1),e("div",ie,[m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.plate_prefix=l),type:"text",required:"",placeholder:"245",maxlength:"3",pattern:"\\d{1,3}",class:"block w-24 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[_,a.value.plate_prefix]]),t[7]||(t[7]=e("span",{class:"text-lg font-bold text-gray-700"},"TN",-1)),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.plate_suffix=l),type:"text",required:"",placeholder:"4521",maxlength:"4",pattern:"\\d{1,4}",class:"block w-28 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[_,a.value.plate_suffix]]),x.value?(u(),r("span",re,[t[6]||(t[6]=y(" AperÃ§u: ",-1)),e("span",ue,o(x.value),1)])):p("",!0)]),e("p",de,o(s.$t("admin.fleet.plate_format")),1)]),e("div",me,[e("label",ce,o(s.$t("admin.fleet.status")),1),e("div",fe,[m(e("input",{id:"auto-manage-toggle","onUpdate:modelValue":t[4]||(t[4]=l=>a.value.auto_manage_status=l),type:"checkbox",class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[z,a.value.auto_manage_status]]),t[8]||(t[8]=e("label",{for:"auto-manage-toggle",class:"ml-2 block text-sm text-gray-700"},[y(" Gestion automatique du statut "),e("span",{class:"text-xs text-gray-500 block"}," Le statut sera automatiquement mis Ã  jour selon les rÃ©servations ")],-1))]),m(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.status=l),disabled:a.value.auto_manage_status||a.value.status!=="maintenance",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"},[e("option",pe,o(s.$t("admin.fleet.disponible")),1),e("option",ve,o(s.$t("admin.fleet.loue")),1),e("option",be,o(s.$t("admin.fleet.maintenance")),1)],8,ge),[[$,a.value.status]]),a.value.auto_manage_status?(u(),r("p",xe," â„¹ï¸ Le statut sera automatiquement dÃ©fini selon les rÃ©servations actives ")):(u(),r("div",_e,[t[9]||(t[9]=e("p",{class:"text-xs text-amber-600"}," âš ï¸ Le statut est contrÃ´lÃ© manuellement. ",-1)),a.value.status!=="maintenance"?(u(),r("p",ye," ðŸ”’ Le statut ne peut Ãªtre modifiÃ© manuellement que si le vÃ©hicule est en maintenance. ")):p("",!0)]))]),e("div",he,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Image de la voiture (optionnel) ",-1)),f.value?(u(),r("div",ke,[e("img",{src:f.value,alt:"AperÃ§u",class:"h-40 w-auto rounded-lg shadow-md object-cover"},null,8,we),e("button",{type:"button",onClick:F,class:"absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500"},[...t[10]||(t[10]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):p("",!0),e("input",{id:"car-image",type:"file",accept:"image/*",onChange:M,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"},null,32),t[12]||(t[12]=e("p",{class:"mt-1 text-sm text-gray-500"}," PNG, JPG, JPEG jusqu'Ã  5MB ",-1))])]),e("div",$e,[A(n,{to:h(w)("/admin/cars"),class:"bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:H(()=>[y(o(s.$t("admin.fleet.cancel")),1)]),_:1},8,["to"]),e("button",{type:"submit",disabled:c.value||h(k),class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50"},o(c.value||h(k)?"Chargement...":s.$t("admin.fleet.save")),9,Ce)])],32)])}}});export{Le as default};
