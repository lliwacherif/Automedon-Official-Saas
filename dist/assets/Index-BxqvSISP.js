import{c as V,d as B,Y as O,r as c,w as Q,a as W,e as n,f as b,o as i,g as e,i as p,C as d,j as r,X,h,F as z,n as I,H as D,I as Y,_ as Z,V as J,E as K,Z as ee,a4 as U,k as te,l as M,v as S,b as N}from"./index-6E32DxFF.js";import{u as E}from"./useStore-DSZ8Lo7O.js";import{L as C}from"./loader-circle-ivbMhOq-.js";import{S as se}from"./search-5_sxXlWq.js";import{P as oe}from"./plus-DIU5xcgi.js";import{T as F}from"./trash-2-CNjQKPy3.js";import{A as ie}from"./arrow-left-Bm8afroD.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=V("UploadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=V("UsersIcon",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),re={key:0,class:"fixed inset-0 z-[100] overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ae={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},de={class:"relative inline-block align-middle bg-white rounded-lg text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:max-w-xl w-full flex flex-col max-h-[85vh] z-50 border border-gray-100"},ce={class:"bg-white px-6 py-4 border-b border-gray-200 flex justify-between items-center flex-shrink-0"},ue={class:"text-xs text-gray-500 mt-1"},me={class:"flex-1 overflow-y-auto p-6 bg-white custom-scrollbar min-h-[300px]"},ge={key:0,class:"flex flex-col items-center justify-center h-full text-gray-500"},pe={key:1,class:"space-y-2"},fe={key:0,class:"text-center py-10 text-gray-500 text-sm"},xe={class:"bg-gray-100 p-3 rounded-full h-12 w-12 flex items-center justify-center mx-auto mb-3"},ve={class:"flex items-center space-x-3 overflow-hidden"},ye={class:"flex-shrink-0 h-10 w-10 rounded-md bg-gray-100 flex items-center justify-center border border-gray-200 overflow-hidden"},be=["src"],he={key:1,class:"text-xs font-bold text-gray-500 select-none"},we={class:"min-w-0 truncate"},_e={class:"text-sm font-medium text-gray-900 truncate"},ke={class:"text-xs text-gray-500 truncate"},$e=["onClick","disabled"],Ae={key:0,class:"flex items-center"},Ce={key:1,class:"flex items-center"},je={key:2},Me={class:"bg-gray-50 px-6 py-4 flex justify-end border-t border-gray-200 flex-shrink-0"},Se=B({__name:"ClientAssignmentModal",props:{show:{type:Boolean},app:{}},emits:["close"],setup(T,{emit:j}){const f=T,$=O(),w=E(),_=c([]),x=c(new Set),g=c(!0),m=c(null),u=c("");Q(()=>f.show,async o=>{o&&f.app&&await k()});async function k(){g.value=!0;try{if(_.value=await $.fetchAllTenants(),f.app){const o=await w.fetchAppAssignments(f.app.id);x.value=new Set(o.map(s=>s.tenant_id))}}catch(o){console.error("Error loading assignment data:",o)}finally{g.value=!1}}const y=W(()=>{if(!u.value)return _.value;const o=u.value.toLowerCase();return _.value.filter(s=>s.name.toLowerCase().includes(o)||s.slug.toLowerCase().includes(o))});async function A(o){if(f.app){m.value=o;try{x.value.has(o)?(await w.unassignAppFromTenant(f.app.id,o),x.value.delete(o)):(await w.assignAppToTenant(f.app.id,o),x.value.add(o))}catch(s){console.error("Error toggling assignment:",s),alert("Failed to update assignment.")}finally{m.value=null}}}return(o,s)=>o.show?(i(),n("div",re,[e("div",ae,[e("div",{class:"fixed inset-0 bg-black/60 transition-opacity backdrop-blur-sm","aria-hidden":"true",onClick:s[0]||(s[0]=a=>o.$emit("close"))}),s[8]||(s[8]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",de,[e("div",ce,[e("div",null,[s[3]||(s[3]=e("h3",{class:"text-lg font-bold text-gray-900",id:"modal-title"}," Manage App Access ",-1)),e("p",ue,p(o.app?.name),1)]),e("button",{onClick:s[1]||(s[1]=a=>o.$emit("close")),class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 rounded-full p-2 transition-colors focus:outline-none"},[d(r(X),{class:"h-5 w-5"})])]),e("div",me,[g.value?(i(),n("div",ge,[d(r(C),{class:"animate-spin h-8 w-8 text-indigo-600 mb-2"}),s[4]||(s[4]=e("p",{class:"text-sm"},"Loading...",-1))])):(i(),n("div",pe,[y.value.length===0?(i(),n("div",fe,[e("div",xe,[d(r(se),{class:"h-6 w-6 text-gray-400"})]),s[5]||(s[5]=h(" No clients found. ",-1))])):b("",!0),(i(!0),n(z,null,I(y.value,a=>(i(),n("div",{key:a.id,class:D(["flex items-center justify-between p-3 rounded-lg border transition-colors relative z-10",x.value.has(a.id)?"bg-indigo-50 border-indigo-200":"bg-white border-gray-200 hover:border-gray-300"])},[e("div",ve,[e("div",ye,[a.logo_url?(i(),n("img",{key:0,src:a.logo_url,class:"h-full w-full object-cover"},null,8,be)):(i(),n("span",he,p(a.name.substring(0,2).toUpperCase()),1))]),e("div",we,[e("p",_e,p(a.name),1),e("p",ke,p(a.slug),1)])]),e("button",{onClick:L=>A(a.id),disabled:!!m.value&&m.value===a.id,class:D(["flex-shrink-0 ml-4 inline-flex items-center justify-center px-4 py-2 border text-xs font-medium rounded-md focus:outline-none transition-colors min-w-[100px] relative z-20 cursor-pointer",x.value.has(a.id)?"border-transparent text-indigo-700 bg-indigo-100 hover:bg-indigo-200":"border-transparent text-white bg-gray-900 hover:bg-gray-800"])},[m.value===a.id?(i(),n("span",Ae,[d(r(C),{class:"animate-spin h-3 w-3 mr-1"}),s[6]||(s[6]=h(" Wait ",-1))])):x.value.has(a.id)?(i(),n("span",Ce,[d(r(Y),{class:"h-3 w-3 mr-1"}),s[7]||(s[7]=h(" Assigned ",-1))])):(i(),n("span",je," Assign "))],10,$e)],2))),128))]))]),e("div",Me,[e("button",{type:"button",class:"w-full sm:w-auto inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:text-sm",onClick:s[2]||(s[2]=a=>o.$emit("close"))}," Close ")])])])])):b("",!0)}}),Te=Z(Se,[["__scopeId","data-v-57c9e471"]]),Le={class:"min-h-screen bg-gray-50 py-8"},De={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Ue={class:"mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Ne={class:"flex items-center"},Fe={key:0,class:"mb-6 bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg shadow-sm"},Ve={class:"flex"},Be={class:"flex-shrink-0"},ze={class:"ml-3"},Ie={class:"text-sm text-red-700 mt-1"},Ee={key:1,class:"flex justify-center py-20"},Pe={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Re={class:"p-6 flex-1"},qe={class:"flex items-start justify-between"},He={class:"h-14 w-14 rounded-xl bg-indigo-50 border border-indigo-100 flex items-center justify-center overflow-hidden flex-shrink-0"},Ge=["src","alt"],Oe={class:"flex items-center space-x-2"},Qe={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},We=["onClick"],Xe=["onClick"],Ye={class:"mt-4"},Ze={class:"text-lg font-bold text-gray-900 group-hover:text-indigo-600 transition-colors"},Je={class:"mt-2 text-sm text-gray-600 line-clamp-3 leading-relaxed"},Ke={class:"bg-gray-50 px-6 py-3 border-t border-gray-100 text-xs text-gray-500 flex justify-between items-center"},et={key:0,class:"col-span-full py-16 text-center bg-white rounded-xl border border-dashed border-gray-300"},tt={key:3,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},st={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ot={class:"inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full"},it={key:0,class:"h-24 w-24 relative"},nt=["src"],lt={key:1,class:"text-center"},rt={class:"space-y-4"},at={class:"mt-1 relative rounded-md shadow-sm"},dt={class:"mt-6 flex justify-end gap-3 border-t border-gray-100 pt-5"},ct=["disabled"],yt=B({__name:"Index",setup(T){const{apps:j,loading:f,error:$,fetchApps:w,addApp:_,deleteApp:x}=E(),g=c(!1),m=c(!1),u=c({name:"",description:"",price:0}),k=c(null),y=c(null),A=c(null),o=c(!1),s=c(null);function a(v){s.value=v,o.value=!0}function L(){o.value=!1,s.value=null}J(()=>{w()});function P(v){const t=v.target;t.files&&t.files[0]&&(k.value=t.files[0],y.value=URL.createObjectURL(t.files[0]))}async function R(){if(u.value.name){m.value=!0;try{await _(u.value,k.value||void 0),g.value=!1,u.value={name:"",description:"",price:0},k.value=null,y.value=null}catch(v){console.error(v)}finally{m.value=!1}}}async function q(v){confirm("Are you sure you want to delete this app?")&&await x(v)}return(v,t)=>{const H=ee("RouterLink");return i(),n("div",Le,[e("div",De,[e("div",Ue,[e("div",Ne,[d(H,{to:"/root/dashboard",class:"p-2 mr-4 bg-white border border-gray-200 rounded-full text-gray-500 hover:text-gray-700 hover:bg-gray-50 transition-colors shadow-sm",title:"Back to Dashboard"},{default:K(()=>[d(r(ie),{class:"w-5 h-5"})]),_:1}),t[7]||(t[7]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 tracking-tight"},"App Store Management"),e("p",{class:"mt-1 text-sm text-gray-500"},"Manage applications available for your tenants.")],-1))]),e("button",{onClick:t[0]||(t[0]=l=>g.value=!0),class:"inline-flex items-center px-5 py-2.5 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 shadow-md transition-all transform hover:-translate-y-0.5"},[d(r(oe),{class:"h-5 w-5 mr-2"}),t[8]||(t[8]=h(" Add New App ",-1))])]),r($)?(i(),n("div",Fe,[e("div",Ve,[e("div",Be,[d(r(F),{class:"h-5 w-5 text-red-500"})]),e("div",ze,[t[9]||(t[9]=e("p",{class:"text-sm font-medium text-red-800"},"Error",-1)),e("p",Ie,p(r($)),1)])])])):b("",!0),r(f)&&!g.value?(i(),n("div",Ee,[d(r(C),{class:"animate-spin h-10 w-10 text-indigo-600"})])):(i(),n("div",Pe,[(i(!0),n(z,null,I(r(j),l=>(i(),n("div",{key:l.id,class:"group bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden flex flex-col"},[e("div",Re,[e("div",qe,[e("div",He,[l.icon_url?(i(),n("img",{key:0,src:l.icon_url,alt:l.name,class:"h-full w-full object-cover transform group-hover:scale-110 transition-transform duration-500"},null,8,Ge)):(i(),N(r(U),{key:1,class:"h-7 w-7 text-indigo-500"}))]),e("div",Oe,[e("span",Qe,p(l.price>0?`${l.price.toFixed(2)} DT`:"Free"),1),e("button",{onClick:G=>a(l),class:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-full transition-colors",title:"Assign to Clients"},[d(r(le),{class:"h-4 w-4"})],8,We),e("button",{onClick:G=>q(l.id),class:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"Delete App"},[d(r(F),{class:"h-4 w-4"})],8,Xe)])]),e("div",Ye,[e("h3",Ze,p(l.name),1),e("p",Je,p(l.description),1)])]),e("div",Ke,[t[10]||(t[10]=e("span",null,[h("Status: "),e("span",{class:"font-medium text-green-600"},"Active")],-1)),e("span",null,"ID: "+p(l.id),1)])]))),128)),r(j).length===0?(i(),n("div",et,[d(r(U),{class:"mx-auto h-12 w-12 text-gray-300"}),t[11]||(t[11]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No apps available",-1)),t[12]||(t[12]=e("p",{class:"mt-1 text-sm text-gray-500"},"Get started by adding a new application to the store.",-1))])):b("",!0)])),g.value?(i(),n("div",tt,[e("div",st,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[1]||(t[1]=l=>g.value=!1)}),t[20]||(t[20]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",ot,[t[19]||(t[19]=e("div",{class:"bg-indigo-600 px-4 py-3 sm:px-6"},[e("h3",{class:"text-lg leading-6 font-medium text-white",id:"modal-title"},"Add New Application")],-1)),e("form",{onSubmit:te(R,["prevent"]),class:"p-6 space-y-5"},[e("div",{class:"flex flex-col items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer relative",onClick:t[2]||(t[2]=l=>A.value?.click())},[e("input",{ref_key:"fileInput",ref:A,type:"file",accept:"image/*",onChange:P,class:"hidden"},null,544),y.value?(i(),n("div",it,[e("img",{src:y.value,class:"h-full w-full object-contain rounded-lg"},null,8,nt),t[13]||(t[13]=e("div",{class:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity rounded-lg"},[e("p",{class:"text-white text-xs font-medium"},"Change")],-1))])):(i(),n("div",lt,[d(r(ne),{class:"mx-auto h-10 w-10 text-gray-400"}),t[14]||(t[14]=e("p",{class:"mt-2 text-sm text-gray-500"},"Click to upload app icon",-1))]))]),e("div",rt,[e("div",null,[t[15]||(t[15]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700"},"App Name",-1)),M(e("input",{type:"text",id:"name","onUpdate:modelValue":t[3]||(t[3]=l=>u.value.name=l),required:"",placeholder:"e.g. Premium Analytics",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5 border"},null,512),[[S,u.value.name]])]),e("div",null,[t[16]||(t[16]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700"},"Description",-1)),M(e("textarea",{id:"description","onUpdate:modelValue":t[4]||(t[4]=l=>u.value.description=l),rows:"3",placeholder:"Describe features and benefits...",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5 border"},null,512),[[S,u.value.description]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"price",class:"block text-sm font-medium text-gray-700"},"Price (DT)",-1)),e("div",at,[M(e("input",{type:"number",id:"price","onUpdate:modelValue":t[5]||(t[5]=l=>u.value.price=l),min:"0",step:"0.01",class:"block w-full pl-3 pr-12 border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5 border"},null,512),[[S,u.value.price,void 0,{number:!0}]]),t[17]||(t[17]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm font-medium"},"DT")],-1))])])]),e("div",dt,[e("button",{type:"button",onClick:t[6]||(t[6]=l=>g.value=!1),class:"px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," Cancel "),e("button",{type:"submit",disabled:m.value,class:"px-4 py-2 bg-indigo-600 border border-transparent rounded-lg text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[m.value?(i(),N(r(C),{key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4"})):b("",!0),h(" "+p(m.value?"Saving...":"Save Application"),1)],8,ct)])],32)])])])):b("",!0),d(Te,{show:o.value,app:s.value,onClose:L},null,8,["show","app"])])])}}});export{yt as default};
