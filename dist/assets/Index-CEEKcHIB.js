import{c as C,d as J,r as g,a as j,V as Q,e as l,o as i,g as e,b as W,l as m,m as D,F as w,n as k,i as a,j as d,C as c,h as I,E as X,D as Z,T as ee,f as v,G as te,k as L,v as f,_ as se}from"./index-BUxJS3To.js";import{u as ne}from"./useCars-CcI3-SoQ.js";import{u as oe,M as A}from"./useMaintenanceRecords-DHipICHS.js";import{f as V}from"./date-BpD5EXL9.js";import{S as ae}from"./square-pen-DNj1WGAK.js";import{T as ie}from"./trash-2-CyFy3x9i.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=C("DollarSignIcon",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=C("GaugeIcon",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=C("MapPinIcon",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=C("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),me={class:"min-h-screen bg-gray-100"},ce={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},xe={class:"px-4 py-6 sm:px-0"},pe={class:"bg-white shadow rounded-lg p-6 mb-6"},ge=["value"],fe={key:0},ye={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},ve={class:"bg-white shadow rounded-lg p-6"},be={class:"space-y-2"},_e={class:"flex justify-between"},he={class:"text-sm font-medium text-gray-900"},we={class:"flex justify-between"},ke={class:"text-sm font-medium text-gray-900"},Ce={class:"flex justify-between"},Me={class:"text-sm font-medium text-gray-900"},Ee={class:"bg-white shadow rounded-lg p-6"},Se={class:"space-y-2"},Ie={class:"flex justify-between"},Ae={class:"text-sm font-medium text-gray-900"},Ne={class:"flex justify-between"},Te={class:"text-lg font-bold text-indigo-600"},je={class:"mb-6"},De={class:"hidden md:block bg-white shadow rounded-lg overflow-hidden"},Le={key:0,class:"p-6 text-center"},Ve={key:1,class:"p-6 text-center"},qe={key:2,class:"overflow-x-auto"},Ge={class:"min-w-full divide-y divide-gray-200"},Pe={class:"bg-white divide-y divide-gray-200"},Re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Oe={class:"px-6 py-4 whitespace-nowrap"},He={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},Ue={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Be={key:0,class:"text-xs text-indigo-600 font-medium mt-1"},$e={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ke={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ze=["onClick"],Ye=["onClick"],Je={class:"md:hidden space-y-4"},Qe={key:0,class:"text-center py-8"},We={key:1,class:"text-center py-8 bg-white rounded-lg shadow"},Xe={class:"flex justify-between items-start"},Ze={class:"flex items-center space-x-2"},et={class:"text-sm font-medium text-gray-900"},tt={class:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"},st={class:"flex items-center space-x-2 text-sm text-gray-600"},nt={key:0,class:"text-xs text-indigo-600 font-medium ml-2"},ot={class:"flex justify-between items-center text-sm"},at={class:"flex items-center space-x-2 text-gray-900 font-semibold"},it={class:"flex items-center space-x-2 text-gray-500"},lt={class:"flex justify-end space-x-3 pt-3 border-t border-gray-100"},dt=["onClick"],rt=["onClick"],ut={key:1,class:"bg-white shadow rounded-lg p-12 text-center"},mt={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},ct={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},xt={class:"text-lg font-semibold text-gray-900"},pt={class:"space-y-4"},gt=["value"],ft={for:"odometer",class:"block text-sm font-medium text-gray-700 mb-1"},yt=["required"],vt={key:0},bt={for:"maintenance-date",class:"block text-sm font-medium text-gray-700 mb-1"},_t=["max"],ht={key:1},wt={class:"mt-6 flex justify-end space-x-3"},kt=["disabled"],Ct=J({__name:"Index",setup(Mt){const{cars:q,fetchCars:G,fetchCarById:M,updateCar:P}=ne(),{maintenanceRecords:x,loading:b,totalMaintenanceCost:R,fetchMaintenanceRecords:O,createMaintenanceRecord:H,updateMaintenanceRecord:U,deleteMaintenanceRecord:B}=oe(),r=g(null),u=g(null),_=g(!1),p=g(!1),y=g(null),o=g({car_id:0,maintenance_type:"OIL_CHANGE",cost:0,odometer:0,maintenance_date:new Date().toISOString().split("T")[0],notes:"",provider:"",next_due_mileage:null}),$=j(()=>q.value.map(n=>({id:n.id,label:`${n.plate_number} - ${n.brand} ${n.model}`,brand:n.brand,model:n.model,plate_number:n.plate_number,mileage:n.mileage||0}))),F=j(()=>Object.entries(A).map(([n,t])=>({value:n,label:t})));async function K(){if(!r.value){u.value=null,x.value=[];return}const n=await M(r.value);u.value=n,await O(r.value)}function z(){p.value=!1,y.value=null,o.value={car_id:r.value,maintenance_type:"OIL_CHANGE",cost:0,odometer:u.value?.mileage||0,maintenance_date:new Date().toISOString().split("T")[0],notes:"",provider:"",next_due_mileage:null},_.value=!0}function N(n){p.value=!0,y.value=n.id,o.value={car_id:n.car_id,maintenance_type:n.maintenance_type,cost:n.cost,odometer:n.odometer,maintenance_date:n.maintenance_date,notes:n.notes||"",provider:n.provider||"",next_due_mileage:n.next_due_mileage||null},_.value=!0}function h(){_.value=!1,p.value=!1,y.value=null}async function Y(){try{if(p.value&&y.value?await U(y.value,o.value):await H(o.value),o.value.maintenance_type==="REPAIR"&&r.value&&await P(r.value,{status:"maintenance"}),r.value){const n=await M(r.value);u.value=n}h()}catch(n){console.error("Error submitting maintenance record:",n)}}async function T(n){if(confirm("Êtes-vous sûr de vouloir supprimer cet enregistrement?"))try{if(await B(n,r.value),r.value){const t=await M(r.value);u.value=t}}catch(t){console.error("Error deleting maintenance record:",t)}}function E(n){return new Intl.NumberFormat("fr-TN",{style:"currency",currency:"TND"}).format(n)}return Q(()=>{G()}),(n,t)=>(i(),l("div",me,[e("main",null,[e("div",ce,[e("div",xe,[t[27]||(t[27]=e("div",{class:"flex items-center justify-between mb-6"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Gestion Maintenance")],-1)),e("div",pe,[t[9]||(t[9]=e("label",{for:"car-select",class:"block text-sm font-medium text-gray-700 mb-2"}," Sélectionner une voiture ",-1)),m(e("select",{id:"car-select","onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),onChange:K,class:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},[t[8]||(t[8]=e("option",{value:null},"-- Choisir une voiture --",-1)),(i(!0),l(w,null,k($.value,s=>(i(),l("option",{key:s.id,value:s.id},a(s.label),9,ge))),128))],544),[[D,r.value]])]),u.value?(i(),l("div",fe,[e("div",ye,[e("div",ve,[t[13]||(t[13]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Informations Véhicule",-1)),e("dl",be,[e("div",_e,[t[10]||(t[10]=e("dt",{class:"text-sm text-gray-500"},"Marque & Modèle:",-1)),e("dd",he,a(u.value.brand)+" "+a(u.value.model),1)]),e("div",we,[t[11]||(t[11]=e("dt",{class:"text-sm text-gray-500"},"Plaque:",-1)),e("dd",ke,a(u.value.plate_number),1)]),e("div",Ce,[t[12]||(t[12]=e("dt",{class:"text-sm text-gray-500"},"Kilométrage Actuel:",-1)),e("dd",Me,a((u.value.mileage||0).toLocaleString())+" km ",1)])])]),e("div",Ee,[t[16]||(t[16]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Statistiques Maintenance",-1)),e("dl",Se,[e("div",Ie,[t[14]||(t[14]=e("dt",{class:"text-sm text-gray-500"},"Nombre d'opérations:",-1)),e("dd",Ae,a(d(x).length),1)]),e("div",Ne,[t[15]||(t[15]=e("dt",{class:"text-sm text-gray-500"},"Coût Total d'Entretien:",-1)),e("dd",Te,a(E(d(R))),1)])])])]),e("div",je,[e("button",{onClick:z,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 w-full sm:w-auto justify-center"},[c(d(ue),{class:"h-5 w-5 mr-2"}),t[17]||(t[17]=I(" Ajouter Entretien ",-1))])]),e("div",De,[t[21]||(t[21]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h2",{class:"text-lg font-semibold text-gray-900"},"Historique d'Entretien")],-1)),d(b)?(i(),l("div",Le,[...t[18]||(t[18]=[e("p",{class:"text-gray-500"},"Chargement...",-1)])])):d(x).length===0?(i(),l("div",Ve,[...t[19]||(t[19]=[e("p",{class:"text-gray-500"},"Aucun enregistrement de maintenance pour ce véhicule.",-1)])])):(i(),l("div",qe,[e("table",Ge,[t[20]||(t[20]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Type "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Kilométrage "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Coût "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Garage "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Pe,[(i(!0),l(w,null,k(d(x),s=>(i(),l("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",Re,a(d(V)(s.maintenance_date)),1),e("td",Oe,[e("span",He,a(d(A)[s.maintenance_type]),1)]),e("td",Ue,[e("div",null,a(s.odometer.toLocaleString())+" km",1),s.next_due_mileage?(i(),l("div",Be," Prochain: "+a(s.next_due_mileage.toLocaleString())+" km ",1)):v("",!0)]),e("td",$e,a(E(s.cost)),1),e("td",Fe,a(s.provider||"-"),1),e("td",Ke,[e("button",{onClick:S=>N(s),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Modifier ",8,ze),e("button",{onClick:S=>T(s.id),class:"text-red-600 hover:text-red-900"}," Supprimer ",8,Ye)])]))),128))])])]))]),e("div",Je,[d(b)?(i(),l("div",Qe,[...t[22]||(t[22]=[e("p",{class:"text-gray-500"},"Chargement...",-1)])])):d(x).length===0?(i(),l("div",We,[...t[23]||(t[23]=[e("p",{class:"text-gray-500"},"Aucun enregistrement.",-1)])])):(i(!0),l(w,{key:2},k(d(x),s=>(i(),l("div",{key:s.id,class:"bg-white rounded-lg shadow p-4 space-y-3"},[e("div",Xe,[e("div",Ze,[c(d(te),{class:"h-4 w-4 text-gray-400"}),e("span",et,a(d(V)(s.maintenance_date)),1)]),e("span",tt,a(d(A)[s.maintenance_type]),1)]),e("div",st,[c(d(de),{class:"h-4 w-4 text-gray-400"}),e("span",null,a(s.odometer.toLocaleString())+" km",1),s.next_due_mileage?(i(),l("span",nt," (Prochain: "+a(s.next_due_mileage.toLocaleString())+" km) ",1)):v("",!0)]),e("div",ot,[e("div",at,[c(d(le),{class:"h-4 w-4 text-gray-400"}),e("span",null,a(E(s.cost)),1)]),e("div",it,[c(d(re),{class:"h-4 w-4 text-gray-400"}),e("span",null,a(s.provider||"-"),1)])]),e("div",lt,[e("button",{onClick:S=>N(s),class:"flex items-center text-indigo-600 hover:text-indigo-900 text-sm font-medium"},[c(d(ae),{class:"h-4 w-4 mr-1"}),t[24]||(t[24]=I(" Modifier ",-1))],8,dt),e("button",{onClick:S=>T(s.id),class:"flex items-center text-red-600 hover:text-red-900 text-sm font-medium"},[c(d(ie),{class:"h-4 w-4 mr-1"}),t[25]||(t[25]=I(" Supprimer ",-1))],8,rt)])]))),128))])])):(i(),l("div",ut,[...t[26]||(t[26]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Aucune voiture sélectionnée",-1),e("p",{class:"mt-1 text-sm text-gray-500"},"Sélectionnez une voiture pour voir son historique de maintenance.",-1)])]))])])]),(i(),W(ee,{to:"body"},[c(Z,{name:"fade"},{default:X(()=>[_.value?(i(),l("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center",onClick:L(h,["self"])},[e("div",mt,[e("div",ct,[e("h3",xt,a(p.value?"Modifier Entretien":"Ajouter Entretien"),1),e("button",{onClick:h,class:"text-gray-400 hover:text-gray-500"},[...t[28]||(t[28]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:L(Y,["prevent"]),class:"px-6 py-4"},[e("div",pt,[e("div",null,[t[29]||(t[29]=e("label",{for:"maintenance-type",class:"block text-sm font-medium text-gray-700 mb-1"}," Type d'Entretien * ",-1)),m(e("select",{id:"maintenance-type","onUpdate:modelValue":t[1]||(t[1]=s=>o.value.maintenance_type=s),required:"",class:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},[(i(!0),l(w,null,k(F.value,s=>(i(),l("option",{key:s.value,value:s.value},a(s.label),9,gt))),128))],512),[[D,o.value.maintenance_type]])]),e("div",null,[e("label",ft,a(o.value.maintenance_type==="OIL_CHANGE"?"Kilométrage *":"Kilométrage"),1),m(e("input",{id:"odometer","onUpdate:modelValue":t[2]||(t[2]=s=>o.value.odometer=s),type:"number",min:"0",required:o.value.maintenance_type==="OIL_CHANGE",class:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Ex: 45000"},null,8,yt),[[f,o.value.odometer,void 0,{number:!0}]])]),o.value.maintenance_type==="OIL_CHANGE"?(i(),l("div",vt,[t[30]||(t[30]=e("label",{for:"next-due-mileage",class:"block text-sm font-medium text-gray-700 mb-1"}," Prochaine Vidange à (km) ",-1)),m(e("input",{id:"next-due-mileage","onUpdate:modelValue":t[3]||(t[3]=s=>o.value.next_due_mileage=s),type:"number",min:"0",class:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Ex: 50000"},null,512),[[f,o.value.next_due_mileage,void 0,{number:!0}]]),t[31]||(t[31]=e("p",{class:"mt-1 text-xs text-gray-500"},"Kilométrage auquel faire la prochaine vidange",-1))])):v("",!0),e("div",null,[t[32]||(t[32]=e("label",{for:"cost",class:"block text-sm font-medium text-gray-700 mb-1"}," Coût (TND) * ",-1)),m(e("input",{id:"cost","onUpdate:modelValue":t[4]||(t[4]=s=>o.value.cost=s),type:"number",min:"0",step:"0.01",required:"",class:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Ex: 150.00"},null,512),[[f,o.value.cost,void 0,{number:!0}]])]),e("div",null,[e("label",bt,a(o.value.maintenance_type==="REPAIR"?"Date de début *":"Date *"),1),m(e("input",{id:"maintenance-date","onUpdate:modelValue":t[5]||(t[5]=s=>o.value.maintenance_date=s),type:"date",required:"",max:new Date().toISOString().split("T")[0],class:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,8,_t),[[f,o.value.maintenance_date]])]),["ASSURANCE","VIGNETTE","LEASING"].includes(o.value.maintenance_type)?v("",!0):(i(),l("div",ht,[t[33]||(t[33]=e("label",{for:"provider",class:"block text-sm font-medium text-gray-700 mb-1"}," Garage / Fournisseur ",-1)),m(e("input",{id:"provider","onUpdate:modelValue":t[6]||(t[6]=s=>o.value.provider=s),type:"text",class:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Ex: Garage Central"},null,512),[[f,o.value.provider]])])),e("div",null,[t[34]||(t[34]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700 mb-1"}," Description / Notes ",-1)),m(e("textarea",{id:"notes","onUpdate:modelValue":t[7]||(t[7]=s=>o.value.notes=s),rows:"3",class:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Détails de l'entretien..."},null,512),[[f,o.value.notes]])])]),e("div",wt,[e("button",{type:"button",onClick:h,class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," Annuler "),e("button",{type:"submit",disabled:d(b),class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50"},a(d(b)?"Enregistrement...":p.value?"Modifier":"Ajouter"),9,kt)])],32)])])):v("",!0)]),_:1})]))]))}}),jt=se(Ct,[["__scopeId","data-v-a8f06b5c"]]);export{jt as default};
