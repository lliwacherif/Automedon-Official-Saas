import{d as R,u as V,Y as N,r,V as A,e as a,o as n,g as t,f as _,C as b,E as k,Z as D,F,n as M,k as E,l as p,v,i as d,U as $,h as y,H as q,j as B}from"./index-_ynkWjCr.js";import{u as z}from"./useFileUpload-DxDFTiRd.js";import{T as O}from"./trash-2-zkxsYHxt.js";const P={class:"min-h-screen bg-gray-50"},G={class:"bg-gray-900 text-white shadow"},H={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center"},Y={class:"flex items-center space-x-4"},Z={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},I={class:"flex justify-between items-center mb-6"},J={key:0,class:"text-center py-12"},K={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Q={class:"h-32 bg-gray-100 flex items-center justify-center p-4"},W=["src"],X={key:1,class:"text-gray-400 text-6xl"},ee={class:"p-6"},te={class:"text-xl font-bold text-gray-900 mb-1"},se={class:"text-sm text-gray-500 mb-4"},le={class:"font-mono bg-gray-100 px-1 rounded"},oe={class:"flex justify-between items-center mt-4"},ae={class:"flex gap-2"},ne=["href"],re=["onClick"],ie={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},de={class:"bg-white rounded-lg shadow-xl w-full max-w-md p-6"},ue={class:"text-xs text-gray-500 mt-1"},ce={class:"mt-1 flex items-center gap-4"},me={key:0,class:"h-12 w-12 rounded overflow-hidden border"},ge=["src"],xe={class:"flex justify-end gap-3 mt-6"},fe=["disabled"],we=R({__name:"Dashboard",setup(be){const C=V(),h=N(),{uploadFile:L}=z(),u=r([]),f=r(!0),c=r(!1),o=r({name:"",slug:"",logo_url:"",admin_password:"admin"}),m=r(null),g=r(null),x=r(!1),w=async()=>{f.value=!0;const{data:l}=await $.from("tenants").select("*").order("created_at",{ascending:!1});l&&(u.value=l),f.value=!1},S=l=>{const e=l.target;if(e.files&&e.files[0]){const i=e.files[0];m.value=i,g.value=URL.createObjectURL(i)}},T=async()=>{x.value=!0;try{let l=o.value.logo_url;if(m.value){const e=await L(m.value,"car-images","logos");e&&(l=e)}await h.createTenant(o.value.name,o.value.slug,l,"admin",o.value.admin_password),c.value=!1,o.value={name:"",slug:"",logo_url:"",admin_password:"admin"},m.value=null,g.value=null,await w()}catch(l){alert("Error creating tenant: "+l.message)}finally{x.value=!1}},U=async l=>{if(confirm("Are you sure you want to delete this client? This action is irreversible and will delete all associated data (Cars, Reservations, Users)."))try{await h.deleteTenant(l),u.value=u.value.filter(e=>e.id!==l)}catch(e){alert("Error deleting tenant: "+e.message)}},j=()=>{C.signOut()};return A(()=>{w()}),(l,e)=>{const i=D("RouterLink");return n(),a("div",P,[t("header",G,[t("div",H,[e[8]||(e[8]=t("div",{class:"flex items-center space-x-3"},[t("span",{class:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-orange-500"}," Automedon Root ")],-1)),t("div",Y,[e[7]||(e[7]=t("span",{class:"text-gray-400"},"root@automedon",-1)),b(i,{to:{name:"root.store"},class:"text-sm bg-gray-800 hover:bg-gray-700 px-3 py-1 rounded transition"},{default:k(()=>[...e[5]||(e[5]=[y(" Store ",-1)])]),_:1}),b(i,{to:{name:"root.settings"},class:"text-sm bg-gray-800 hover:bg-gray-700 px-3 py-1 rounded transition"},{default:k(()=>[...e[6]||(e[6]=[y(" Settings ",-1)])]),_:1}),t("button",{onClick:j,class:"text-sm bg-red-900 hover:bg-red-800 px-3 py-1 rounded transition"}," Logout ")])])]),t("main",Z,[t("div",I,[e[9]||(e[9]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Managed Clients (Tenants)",-1)),t("button",{onClick:e[0]||(e[0]=s=>c.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow flex items-center gap-2"}," + New Client ")]),f.value?(n(),a("div",J,"Loading clients...")):(n(),a("div",K,[(n(!0),a(F,null,M(u.value,s=>(n(),a("div",{key:s.id,class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition"},[t("div",Q,[s.logo_url?(n(),a("img",{key:0,src:s.logo_url,class:"max-h-full max-w-full object-contain"},null,8,W)):(n(),a("span",X,"ðŸ¢"))]),t("div",ee,[t("h3",te,d(s.name),1),t("p",se,[e[10]||(e[10]=y("Slug: ",-1)),t("span",le,d(s.slug),1)]),t("div",oe,[t("span",{class:q([{"bg-green-100 text-green-800":s.status==="active","bg-red-100 text-red-800":s.status!=="active"},"px-2 py-1 rounded text-xs font-semibold uppercase"])},d(s.status),3),t("div",ae,[t("a",{href:`/${s.slug}/admin`,target:"_blank",class:"text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center gap-1"}," Access â†’ ",8,ne),t("button",{onClick:pe=>U(s.id),class:"text-red-500 hover:text-red-700 text-sm font-medium flex items-center gap-1",title:"Delete Client"},[b(B(O),{class:"w-4 h-4"})],8,re)])])])]))),128))]))]),c.value?(n(),a("div",ie,[t("div",de,[e[15]||(e[15]=t("h3",{class:"text-lg font-bold mb-4"},"Create New Client",-1)),t("form",{onSubmit:E(T,["prevent"]),class:"space-y-4"},[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"Client Name",-1)),p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.name=s),type:"text",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2",placeholder:"e.g. GS Cars Rent Car"},null,512),[[v,o.value.name]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"Slug (URL)",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.slug=s),type:"text",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2",placeholder:"e.g. gs-cars"},null,512),[[v,o.value.slug]]),t("p",ue,"Access URL: domain.com/"+d(o.value.slug||"slug")+"/admin",1)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"Logo",-1)),t("div",ce,[g.value?(n(),a("div",me,[t("img",{src:g.value,class:"h-full w-full object-contain"},null,8,ge)])):_("",!0),t("input",{onChange:S,type:"file",accept:"image/*",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32)])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Admin Password (Username: admin)",-1)),p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.admin_password=s),type:"text",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2"},null,512),[[v,o.value.admin_password]])]),t("div",xe,[t("button",{type:"button",onClick:e[4]||(e[4]=s=>c.value=!1),class:"text-gray-600 hover:text-gray-800 px-4 py-2"},"Cancel"),t("button",{type:"submit",disabled:x.value,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"},d(x.value?"Creating...":"Create Client"),9,fe)])],32)])])):_("",!0)])}}});export{we as default};
